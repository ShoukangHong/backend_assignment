# URL Shortener Service

## Introduction

This document outlines the implementation approach for a URL shortener service backend. The service provides APIs for shortening URLs, managing user accounts, tracking URL usage, and enforcing rate limiting based on user tiers.

## Implementation Overview

### Tech Stack

- **Node.js** - The runtime environment for running the server-side JavaScript code.
- **Express.js** - The web application framework for creating API endpoints.
- **Mongoose** - The Object Data Modeling (ODM) library for MongoDB and Node.js.
- **MongoDB** - The NoSQL database for storing user and URL data.
- **bcrypt** - The library for hashing passwords.
- **jsonwebtoken** - The library for generating and verifying JSON Web Tokens (JWT) for user authentication.

### Project Structure

The project is structured as follows:
```
│  .env
│  package.json
│  server.js
│
├─models
│      Url.js
│      User.js
│
├─helpers
│      generateUniqueShortUrl.js
│
├─middleware
│      authenticateToken.js
│      checkRateLimit.js
│
├─controllers
│      urlController.js
│      userController.js
│
└─routes
        urlRoute.js
        userRoute.js
```

### Database Schema

## URL Schema

The `Url` Schema is responsible for mapping long URLs to their shortened counterparts. It includes the following fields:
- `_id`: The id generated by MongoDB.
- `longUrl`: The original URL that needs to be shortened.
- `shortUrl`: The unique, shortened version of the URL. It is indexed for fast lookup and marked as unique.
- `userId`: A reference to the `User` model that indicates ownership of the shortened URL. This field is indexed for efficient retrieval of all URLs associated with a specific user.

This model facilitates the core functionality of a URL-shortening service, allowing users to create short, memorable links that redirect to longer URLs.

## User Schema

The `User` Schema maintains user-specific data. Its fields include:
- `_id`: The id generated by MongoDB.
- `userName`: The unique username for the user account. It is required and indexed to support efficient user lookups.
- `encryptedPassword`: The hashed password for the user account, ensuring security and privacy.
- `tier`: Represents the user's subscription level or tier within the service. This can dictate their access to various features or rate limits.
- `requestCount`: Tracks the number of requests a user has made within a specific time frame, crucial for implementing rate limiting.
- `lastRequest`: The timestamp of the user's last request, used in conjunction with `requestCount` to reset the rate limit window.

The `User` model is integral to the user management aspect of the service, handling authentication, authorization, and service tiering.

### Core Functionalities

#### Authentication

- **Signup/Login/Logout**: Implemented in `userController.js` using bcrypt for password hashing and JWT for session management.
- **Token Verification**: Middleware in `authenticateToken.js` that validates JWTs for protected routes.

#### URL Management

- **Shortening URLs**: `urlController.js` handles the creation of shortened URLs, either randomly generated or custom aliases.
- **Redirection**: A GET endpoint that redirects the short URL to the original URL.
- **URL History**: Users can fetch their URL history through an endpoint that queries based on the user ID.

#### Rate Limiting

- Implemented via `checkRateLimit.js` middleware which enforces request limits based on user tiers and resets the count based on the rate limit window.

### Environmental Variables

The configuration is handled by a `.env` file which includes:

- `URL_SHORTENER_DB_URL`: The MongoDB connection string.
- `PORT`: The port number for the server.
- `JWT_SECRET`: The secret key for signing JWTs.
The `.env` file is excluded from version control to protect sensitive information.

### Usage

1. Install dependencies using `npm install`.
2. Set up the `.env` file with the necessary environment variables.
3. Run the server using `npm start`.


